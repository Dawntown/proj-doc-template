% Style settings for beamer slides
% Referenced from research-collection/preamble.tex
% Note: ctex and tikz should be loaded before this preamble (in slides.tex)

% Configure natbib for Beamer (use numbers instead of author-year)
% This must be done before loading preamble_base.tex
\PassOptionsToPackage{numbers,sort&compress}{natbib}
\PassOptionsToPackage{most,many,breakable}{tcolorbox}

\input{../preamble_base.tex}

% Additional packages for slides
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{framed}
\usepackage{multicol}
\usepackage{ragged2e}
\justifying\let\raggedright\justifying
\usepackage[export]{adjustbox}
\usepackage{latexsym}
\usepackage{calligra}
\usepackage{pstricks}
\usepackage{listings}
\usepackage{stackengine}
\usepackage{makecell}
\usepackage{CUHK}  % CUHK beamer theme with purple header, golden title, and navigation dots
\usepackage{pifont}
\usepackage{ulem}
\usepackage{empheq}
\usepackage[font=scriptsize]{caption}
\usepackage{advdate}
\usepackage{extarrows}
\usepackage{bbm}

% Additional symbol definitions (base preamble has common ones)
% Slides-specific symbols
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\DeclareMathOperator*{\mean}{mean}
\DeclareMathOperator*{\diag}{diag}

% User-defined commands
\def\cmd#1{\texttt{\color{red}\footnotesize $\backslash$#1}}
\def\env#1{\texttt{\color{blue}\footnotesize #1}}
\def\ulbf#1{\textbf{\underline{#1}}}
\def\todo#1{\large\color{red}\textit{#1}}

% Listings settings (matching research-collection style)
\xdefinecolor{cuhk1}{rgb}{0.457,0.0585,0.42578}      %RGB(117,15,109)
\xdefinecolor{cuhk2}{rgb}{0.86328,0.63671875,0}      %RGB(221,163,0)
\xdefinecolor{cuhk3}{rgb}{0.953125,0.87109,0.6875}   %RGB(244,223,176)

\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{frenchblue}{rgb}{0.0, 0.25, 0.63}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                           Beamer Theorem Environments                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Additional packages for theorem environments in Beamer
\usepackage{thmtools}
\tcbuselibrary{theorems,skins,hooks}
\usetikzlibrary{arrows,calc,shadows.blur}

% Base colors harmonized with CUHK theme
\definecolor{cuhkpurple}{RGB}{117, 15, 109}    % CUHK primary purple
\definecolor{cuhkgold}{RGB}{221, 163, 0}       % CUHK gold
\definecolor{cuhkbeige}{RGB}{244, 223, 176}    % CUHK beige

% Theme colors (harmonized palette)
\definecolor{myblue}{RGB}{45, 111, 177}        % Complementary blue
\definecolor{mygreen}{RGB}{56, 140, 70}        % Nature green
\definecolor{myorange}{RGB}{255, 140, 0}      % Warm orange
\definecolor{mypurple}{RGB}{117, 15, 109}      % Matching CUHK purple
\definecolor{myteal}{RGB}{0, 128, 128}         % Teal accent

% Environment colors (harmonized with theme - softened for subtlety)
\colorlet{theorem}{cuhkpurple!65!black}       % Soft purple for theorems
\colorlet{lemma}{cuhkpurple!55!blue}          % Soft purple-blue for lemmas
\colorlet{corollary}{cuhkpurple!50!mypurple}  % Soft purple variant for corollaries
\colorlet{prop}{cuhkpurple!60!black}          % Soft purple for propositions
\colorlet{claim}{myteal!60!black}             % Soft teal for claims
\colorlet{definition}{mygreen!60!black}       % Soft green for definitions
\colorlet{example}{cuhkgold!65!black}        % Soft gold for examples
\colorlet{exercise}{myorange!55!black}       % Soft orange for exercises
\colorlet{proof}{theorem}                     % Same as theorem

% Override Beamer's default theorem environment styling with tcolorbox
% Using tcolorbox blocks that work well with Beamer
\makeatletter

% Custom theorem-like environments using tcolorbox blocks
\newtcolorbox{tcbtheorem}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=theorem!4,
    colframe=theorem!70!black,
    colbacktitle=theorem!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=theorem!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Theorem\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcblemma}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=lemma!4,
    colframe=lemma!70!black,
    colbacktitle=lemma!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=lemma!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Lemma\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbcorollary}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=corollary!4,
    colframe=corollary!70!black,
    colbacktitle=corollary!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=corollary!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Corollary\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbprop}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=prop!4,
    colframe=prop!70!black,
    colbacktitle=prop!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=prop!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Proposition\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbclaim}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=claim!4,
    colframe=claim!70!black,
    colbacktitle=claim!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=claim!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Claim\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbdefinition}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=definition!3,
    colframe=definition!70!black,
    colbacktitle=definition!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=definition!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Definition\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbexample}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=example!5,
    colframe=example!70!black,
    colbacktitle=example!65!black,
    coltitle=white,
    boxrule=1.5pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=example!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Example\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbexercise}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=exercise!4,
    colframe=exercise!70!black,
    colbacktitle=exercise!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=exercise!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Exercise\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbquestion}[1][]{
    enhanced,
    breakable,
    before skip=2mm,
    after skip=2mm,
    colback=myblue!3,
    colframe=myblue!70!black,
    colbacktitle=myblue!65!black,
    coltitle=white,
    boxrule=1.2pt,
    arc=4pt,
    left=4mm,
    right=4mm,
    top=3mm,
    bottom=3mm,
    fonttitle=\bfseries\sffamily,
    attach boxed title to top left={
        xshift=4mm,
        yshift*=-2mm
    },
    boxed title style={
        enhanced,
        colback=myblue!65!black,
        arc=4pt,
        boxrule=0pt
    },
    title=\textbf{Question\ifx\relax#1\relax\else: #1\fi}
}

\newtcolorbox{tcbsolution}[1][]{
    enhanced,
    breakable,
    before skip=2mm,
    after skip=2mm,
    colback=definition!4,
    colframe=definition!70!black,
    boxrule=0pt,
    leftrule=2pt,
    rightrule=0pt,
    toprule=0pt,
    bottomrule=0pt,
    arc=3pt,
    left=8mm,
    right=4mm,
    top=2mm,
    bottom=2mm,
    fonttitle=\bfseries\sffamily\color{definition!70!black},
    title={\textbf{Solution\ifx\relax#1\relax\else: #1\fi}}
}

% Note - Beamer has a default note environment, so we create a custom one
\newtcolorbox{notebox}[1][]{%
    enhanced,
    colback=cuhkbeige!10,%
    colframe=cuhkbeige!55!black,
    size=small,
    boxrule=1.2pt,
    arc=4pt,
    title=\textbf{Note},
    halign title=flush left,
    coltitle=cuhkpurple!65!black,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    left=3mm,
    right=3mm,
    top=2mm,
    bottom=2mm,
    #1,
}

% Proof - Beamer has a default proof environment, so we create a custom one with vertical line style
\newtcolorbox{proofbox}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=proof!4,
    colframe=proof!70!black,
    boxrule=0pt,
    leftrule=2pt,
    rightrule=0pt,
    toprule=0pt,
    bottomrule=0pt,
    arc=3pt,
    left=8mm,
    right=4mm,
    top=2mm,
    bottom=2mm,
    before upper={\textbf{\textcolor{proof!70!black}{Proof\ifx\relax#1\relax\else: #1\fi}}\par\vspace{-2mm}},
    #1
}

\newtcolorbox{explanation}[1][]{
    enhanced,
    breakable,
    parbox=false,
    before skip=2mm plus 0.5mm minus 0.5mm,
    after skip=2mm plus 0.5mm minus 0.5mm,
    colback=example!4,
    colframe=example!70!black,
    boxrule=0pt,
    leftrule=2pt,
    rightrule=0pt,
    toprule=0pt,
    bottomrule=0pt,
    arc=3pt,
    left=8mm,
    right=4mm,
    top=2mm,
    bottom=2mm,
    fonttitle=\bfseries\sffamily\color{example!70!black},
    title={\textbf{Explanation\ifx\relax#1\relax\else: #1\fi}}
}

% Note: Beamer already defines 'note' environment, so we don't redefine it
% Use \begin{notebox}...\end{notebox} directly if you need the custom styled note box
% Beamer's note environment is used for speaker notes, so we don't override it

% Redefine proof environment using proofbox with title option support
\RenewDocumentEnvironment{proof}{O{}}{%
    \begin{proofbox}[#1]
}{%
    \end{proofbox}
}

% Redefine standard beamer theorem environments to use tcolorbox
% Beamer's theorem environments are block-based, so we'll use tcolorbox blocks
% Pass the optional argument directly to tcolorbox, which will use it as the title suffix
\RenewDocumentEnvironment{theorem}{O{}}{%
    \begin{tcbtheorem}[#1]
}{%
    \end{tcbtheorem}
}

\RenewDocumentEnvironment{lemma}{O{}}{%
    \begin{tcblemma}[#1]
}{%
    \end{tcblemma}
}

\RenewDocumentEnvironment{corollary}{O{}}{%
    \begin{tcbcorollary}[#1]
}{%
    \end{tcbcorollary}
}

% prop, claim, exercise are not standard Beamer environments, so we use NewDocumentEnvironment
\NewDocumentEnvironment{prop}{O{}}{%
    \begin{tcbprop}[#1]
}{%
    \end{tcbprop}
}

\NewDocumentEnvironment{claim}{O{}}{%
    \begin{tcbclaim}[#1]
}{%
    \end{tcbclaim}
}

\RenewDocumentEnvironment{definition}{O{}}{%
    \begin{tcbdefinition}[#1]
}{%
    \end{tcbdefinition}
}

\RenewDocumentEnvironment{example}{O{}}{%
    \begin{tcbexample}[#1]
}{%
    \end{tcbexample}
}

\NewDocumentEnvironment{exercise}{O{}}{%
    \begin{tcbexercise}[#1]
}{%
    \end{tcbexercise}
}

\NewDocumentEnvironment{question}{O{}}{%
    \begin{tcbquestion}[#1]
}{%
    \end{tcbquestion}
}

% Solution environment - check if already defined
\@ifundefined{solution}{%
    \NewDocumentEnvironment{solution}{O{}}{%
        \begin{tcbsolution}[#1]
    }{%
        \end{tcbsolution}
    }
}{%
    \RenewDocumentEnvironment{solution}{O{}}{%
        \begin{tcbsolution}[#1]
    }{%
        \end{tcbsolution}
    }
}

\makeatother

\lstset{
    basicstyle=\ttfamily\small,
    keywordstyle=\bfseries\color{cuhk1},
    emphstyle=\ttfamily\color{deepred},
    stringstyle=\color{cuhk2},
    numbers=left,
    numberstyle=\small\color{cuhk3},
    rulesepcolor=\color{red!20!green!20!blue!20},
    frame=shadowbox,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Generic Reusable Blocks Based on Colors and Styles                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Generic tcolorbox with vertical line style (left border only)
% Usage: \begin{vertlineblock}[color]{title}...\end{vertlineblock}
% Example: \begin{vertlineblock}[myorange]{Important Note}...\end{vertlineblock}
\newtcolorbox{vertlineblock}[2][]{
  enhanced,
  breakable,
  parbox=false,
  before skip=2mm plus 0.5mm minus 0.5mm,
  after skip=2mm plus 0.5mm minus 0.5mm,
  colback=#1!4,
  colframe=#1!70!black,
  boxrule=0pt,
  leftrule=2pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  arc=3pt,
  left=8mm,
  right=4mm,
  top=2mm,
  bottom=2mm,
  fonttitle=\bfseries\sffamily\color{#1!70!black},
  title={#2}
}

% Generic tcolorbox with full border style
% Usage: \begin{fullborderblock}[color]{title}...\end{fullborderblock}
% Example: \begin{fullborderblock}[cuhkgold]{Key Point}...\end{fullborderblock}
\newtcolorbox{fullborderblock}[2][]{
  enhanced,
  breakable,
  parbox=false,
  before skip=2mm plus 0.5mm minus 0.5mm,
  after skip=2mm plus 0.5mm minus 0.5mm,
  colback=#1!5,
  colframe=#1!70!black,
  boxrule=2pt,
  arc=3pt,
  left=4mm,
  right=4mm,
  top=2mm,
  bottom=2mm,
  fonttitle=\bfseries\sffamily\color{#1!70!black},
  title={#2}
}

% Generic tcolorbox with title box style (colored title box attached to top)
% Usage: \begin{titleboxblock}[color]{title}...\end{titleboxblock}
% Example: \begin{titleboxblock}[mygreen]{Key Concept}...\end{titleboxblock}
\newtcolorbox{titleboxblock}[2][]{
  enhanced,
  breakable,
  parbox=false,
  before skip=2mm plus 0.5mm minus 0.5mm,
  after skip=2mm plus 0.5mm minus 0.5mm,
  colback=#1!3,
  colframe=#1!70!black,
  colbacktitle=#1!65!black,
  coltitle=white,
  boxrule=1.2pt,
  arc=4pt,
  left=4mm,
  right=4mm,
  top=2mm,
  bottom=2mm,
  attach boxed title to top left={
    xshift=4mm,
    yshift*=-2mm
  },
  varwidth boxed title*=-3cm,
  boxed title style={
    enhanced,
    colback=#1!65!black,
    arc=4pt,
    interior style={fill=#1!65!black}
  },
  fonttitle=\bfseries\sffamily,
  title={#2},
  left=4mm,
  right=4mm,
  top=2mm,
  bottom=2mm
}

% Generic highlight block with optional title
% Usage: \begin{highlightblock}[color]{title}...\end{highlightblock}
%        or \begin{highlightblock}[color]{}...\end{highlightblock} (no title)
% Example: \begin{highlightblock}[myblue]{Reminder}...\end{highlightblock}
% Note: Title uses white text on colored background for better contrast
\newtcolorbox{highlightblock}[2][]{
  enhanced,
  breakable,
  parbox=false,
  before skip=2mm plus 0.5mm minus 0.5mm,
  after skip=2mm plus 0.5mm minus 0.5mm,
  colback=#1!4,
  colframe=#1!70!black,
  colbacktitle=#1!65!black,
  coltitle=white,
  boxrule=1.2pt,
  arc=4pt,
  left=4mm,
  right=4mm,
  top=2mm,
  bottom=2mm,
  fonttitle=\bfseries\sffamily,
  attach boxed title to top left={
    xshift=4mm,
    yshift*=-2mm
  },
  boxed title style={
    enhanced,
    colback=#1!65!black,
    arc=4pt,
    boxrule=0pt
  },
  title={#2}
}

% Convenience environments using predefined colors
% Vertical line style blocks (left border only, like Exercise and Proof)
% Usage: \begin{purplevertblock}{title}...\end{purplevertblock}
\NewDocumentEnvironment{purplevertblock}{O{}}{%
  \begin{vertlineblock}[cuhkpurple]{#1}
}{%
  \end{vertlineblock}
}

\NewDocumentEnvironment{goldvertblock}{O{}}{%
  \begin{vertlineblock}[cuhkgold]{#1}
}{%
  \end{vertlineblock}
}

\NewDocumentEnvironment{greenvertblock}{O{}}{%
  \begin{vertlineblock}[mygreen]{#1}
}{%
  \end{vertlineblock}
}

\NewDocumentEnvironment{bluevertblock}{O{}}{%
  \begin{vertlineblock}[myblue]{#1}
}{%
  \end{vertlineblock}
}

\NewDocumentEnvironment{orangevertblock}{O{}}{%
  \begin{vertlineblock}[myorange]{#1}
}{%
  \end{vertlineblock}
}

% Title box style blocks (colored title box, like Definition)
% Usage: \begin{purpletitleblock}{title}...\end{purpletitleblock}
\NewDocumentEnvironment{purpletitleblock}{O{}}{%
  \begin{titleboxblock}[cuhkpurple]{#1}
}{%
  \end{titleboxblock}
}

\NewDocumentEnvironment{goldtitleblock}{O{}}{%
  \begin{titleboxblock}[cuhkgold]{#1}
}{%
  \end{titleboxblock}
}

\NewDocumentEnvironment{greentitleblock}{O{}}{%
  \begin{titleboxblock}[mygreen]{#1}
}{%
  \end{titleboxblock}
}

\NewDocumentEnvironment{bluetitleblock}{O{}}{%
  \begin{titleboxblock}[myblue]{#1}
}{%
  \end{titleboxblock}
}

% Full border style blocks (all sides, like Example)
% Usage: \begin{goldborderblock}{title}...\end{goldborderblock}
\NewDocumentEnvironment{goldborderblock}{O{}}{%
  \begin{fullborderblock}[cuhkgold]{#1}
}{%
  \end{fullborderblock}
}

\NewDocumentEnvironment{purpleborderblock}{O{}}{%
  \begin{fullborderblock}[cuhkpurple]{#1}
}{%
  \end{fullborderblock}
}

% Override figure/table names for English in Chinese documents
\renewcommand{\figurename}{Figure}
\renewcommand{\tablename}{Table}
\renewcommand{\refname}{References}

% Additional command for date advancement
\newcommand{\advanceday}[1][14]{
\begingroup
\AdvanceDate[#1]
\today
\endgroup
}

